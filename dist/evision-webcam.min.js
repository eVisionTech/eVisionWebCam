class Webcam{constructor(e,t="user",i=null){this._webcamElement=e,this._webcamElement.width=this._webcamElement.width||640,this._webcamElement.height=this._webcamElement.height||video.width*(3/4),this._facingMode=t,this._webcamList=[],this._streamList=[],this._selectedDeviceId="",this._canvasElement=i,this._mediaRecorder=null,this._mediaDataChunks=[],this._DEFAULT_RECORD_MIME_TYPE="video/webm; codecs=vp9",this._DEFAULT_RECORD_TIMESLICE=250}get facingMode(){return this._facingMode}set facingMode(e){this._facingMode=e}get webcamList(){return this._webcamList}get webcamCount(){return this._webcamList.length}get selectedDeviceId(){return this._selectedDeviceId}getVideoInputs(e){return this._webcamList=e.filter(e=>"videoinput"===e.kind),1==this._webcamList.length&&(this._facingMode="user"),this._webcamList}getMediaConstraints(){let e={};return""==this._selectedDeviceId?e.facingMode=this._facingMode:e.deviceId={exact:this._selectedDeviceId},{video:e,audio:!1}}selectCamera(){for(let e of this._webcamList)if("user"==this._facingMode&&e.label.toLowerCase().includes("front")||"enviroment"==this._facingMode&&e.label.toLowerCase().includes("back")){this._selectedDeviceId=e.deviceId;break}}flip(){this._facingMode="user"==this._facingMode?"enviroment":"user",this._webcamElement.style.transform="",this.selectCamera()}async start(e=!0){return new Promise(async(t,i)=>{try{this.stop();let s=await navigator.mediaDevices.getUserMedia(this.getMediaConstraints());if(this._streamList.push(s),await this.info(),this.selectCamera(),!e)return t(this._selectedDeviceId);await this.stream(),t(this._facingMode)}catch(a){i(a)}})}async info(){return new Promise(async(e,t)=>{try{let i=await navigator.mediaDevices.enumerateDevices();this.getVideoInputs(i),e(this._webcamList)}catch(s){t(s)}})}async stream(){return new Promise(async(e,t)=>{try{let i=await navigator.mediaDevices.getUserMedia(this.getMediaConstraints());this._streamList.push(i),this._webcamElement.srcObject=i,"user"==this._facingMode&&(this._webcamElement.style.transform="scale(-1,1)"),this._webcamElement.play(),e(this._facingMode)}catch(s){t(s)}})}stop(){this._streamList.forEach(e=>{e.getTracks().forEach(e=>{e.stop()})})}snap(){if(null==this._canvasElement)throw"canvas element is missing";this._canvasElement.height=this._webcamElement.scrollHeight,this._canvasElement.width=this._webcamElement.scrollWidth;let e=this._canvasElement.getContext("2d");return"user"==this._facingMode&&(e.translate(this._canvasElement.width,0),e.scale(-1,1)),e.clearRect(0,0,this._canvasElement.width,this._canvasElement.height),e.drawImage(this._webcamElement,0,0,this._canvasElement.width,this._canvasElement.height),this._canvasElement.toDataURL("image/png")}startRecord({mimeType:e=this._DEFAULT_RECORD_MIME_TYPE,timeslice:t=this._DEFAULT_RECORD_TIMESLICE,...i}={}){try{if(this._mediaRecorder)return;this._mediaRecorder=new MediaRecorder(this._webcamElement.srcObject,{mimeType:MediaRecorder.isTypeSupported(e)?e:MediaRecorder.isTypeSupported("video/webm; codecs=vp9")?"video/webm; codecs=vp9":MediaRecorder.isTypeSupported("video/webm")?"video/webm":MediaRecorder.isTypeSupported("video/mp4")?"video/mp4":this._DEFAULT_RECORD_MIME_TYPE,...i}),this._mediaRecorder.onerror=({error:e})=>e,this._mediaRecorder.ondataavailable=({data:e})=>{this._mediaDataChunks.push(e)},this._mediaRecorder.start(t)}catch(s){return s}}stopRecord(){try{if(!this._mediaRecorder)return;this._mediaRecorder.stop();let e=this._mediaRecorder.mimeType,t=this._mediaDataChunks;return this._mediaRecorder.ondataavailable=null,this._mediaRecorder=null,this._mediaDataChunks=[],{chunks:t,mimeType:e}}catch(i){return i}}}